{% extends 'core/base_cliente.html' %}
{% load static %}

{% block title %}Dashboard - {{ block.super }}{% endblock %}

{% block extrastyles %}
<style>
    /* Estilos existentes (sem alterações) */
    .btn-primary-custom { background-color: #8A9A5B; border-color: #8A9A5B; border-radius: 24px; padding: 10px 20px; font-weight: 500; }
    .btn-primary-custom:hover { background-color: #7A8A4C; border-color: #7A8A4C; }
    .card-custom { border-radius: 24px; border: none; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); background-color: white; }
    .consulta-card { background-color: #f7f9f2; border: 1px solid #e8ede0; border-radius: 24px; padding: 1.25rem; }
    .badge-online { background-color: #8A9A5B; color: white; border-radius: 12px; padding: 0.3em 0.6em; font-size: 0.8rem; }
    .details-link { color: #7A8A4C; font-weight: 500; text-decoration: none; }
    .details-link:hover { text-decoration: underline; }
    /* Removido estilo .evolucao-item */
    .refeicao-card { border-radius: 24px; padding: 15px; height: 100%; display: flex; flex-direction: column; }
    .refeicao-card h6 { font-weight: 600; color: #333; margin-bottom: auto; }
    .refeicao-card i { margin-right: 8px; }
    /* Cores das refeições */
    .cafe { background-color: #FFF4E6; border: 1px solid #FFE8CC; } .cafe i { color: #FB8C00; }
    .almoco { background-color: #E6F7EA; border: 1px solid #CCEBD4; } .almoco i { color: #2E7D32; }
    .lanche { background-color: #FFF9E6; border: 1px solid #FFECB3; } .lanche i { color: #F9A825; }
    .jantar { background-color: #F3E5F5; border: 1px solid #E1BEE7; } .jantar i { color: #6A1B9A; }
    .no-data-message { color: #6c757d; text-align: center; padding: 1rem 0; font-size: 0.9rem; }
</style>
{% endblock %}


{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="h4 fw-bold mb-0">Olá, {{ request.user.first_name }}!</h2>
        <p class="text-muted mb-0">Bem-vindo de volta ao seu painel pessoal</p>
    </div>
    <a href="#" class="btn btn-primary-custom">
        <i class="bi bi-plus-lg"></i> Agendar nova consulta
    </a>
</div>

<div class="row g-4">
    {# Coluna única ocupando toda a largura #}
    <div class="col-lg-12"> 
        <div class="card card-custom mb-4">
            <div class="card-body p-4">
                <h5 class="card-title fw-bold">Sua Próxima Consulta</h5>
                {% if proxima_consulta %}
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <p class="text-muted mb-0">com Dr(a). {{ proxima_consulta.nutricionista.usuario.get_full_name }}</p> 
                        {% if proxima_consulta.modalidade == 'ONLINE' %}
                            <span class="badge-online">Online</span>
                        {% else %}
                            <span class="badge bg-secondary rounded-pill">Presencial</span> 
                        {% endif %}
                    </div>
                    <div class="consulta-card d-flex align-items-center">
                        <i class="bi bi-calendar-week-fill text-muted fs-4 me-3"></i>
                        <div>
                            <span class="fw-bold d-block">{{ proxima_consulta.data_horario|date:"d/m/Y - H:i" }}</span> 
                        </div>
                    </div>
                    <a href="#" class="details-link mt-3 d-inline-block">Ver detalhes da consulta</a>
                {% else %}
                    <p class="no-data-message">Sem consultas agendadas.</p>
                {% endif %}
            </div>
        </div>

        <div class="card card-custom">
            <div class="card-body p-4">
                <h5 class="card-title fw-bold mb-4">Resumo do seu plano alimentar</h5>
                <div class="row g-3">
                    {# --- MUDANÇA AQUI: Voltando para col-md-6 --- #}
                    {% with refeicao=refeicoes.cafe_da_manha %} 
                    <div class="col-md-6"> 
                        <div class="refeicao-card cafe">
                            <h6><i class="bi bi-brightness-high-fill"></i> {{ refeicao.nome|default:"Café da Manhã" }}</h6>
                            {% if refeicao %}
                                <p class="text-muted small">{{ refeicao.alimentos|truncatewords:5|default:"-" }}</p> 
                            {% else %}
                                 <p class="no-data-message small my-2">Não definido</p>
                            {% endif %}
                        </div>
                    </div>
                    {% endwith %}
                    {% with refeicao=refeicoes.almoco %}
                    <div class="col-md-6"> 
                         <div class="refeicao-card almoco">
                            <h6><i class="bi bi-sun-fill"></i> {{ refeicao.nome|default:"Almoço" }}</h6>
                            {% if refeicao %}
                                <p class="text-muted small">{{ refeicao.alimentos|truncatewords:5|default:"-" }}</p> 
                            {% else %}
                                 <p class="no-data-message small my-2">Não definido</p>
                            {% endif %}
                        </div>
                    </div>
                    {% endwith %}
                    {% with refeicao=refeicoes.lanche_da_tarde %} 
                    <div class="col-md-6"> 
                         <div class="refeicao-card lanche">
                            <h6><i class="bi bi-clock-fill"></i> {{ refeicao.nome|default:"Lanche da Tarde" }}</h6>
                            {% if refeicao %}
                                <p class="text-muted small">{{ refeicao.alimentos|truncatewords:5|default:"-" }}</p> 
                            {% else %}
                                 <p class="no-data-message small my-2">Não definido</p>
                            {% endif %}
                        </div>
                    </div>
                     {% endwith %}
                     {% with refeicao=refeicoes.jantar %}
                    <div class="col-md-6"> 
                        <div class="refeicao-card jantar">
                            <h6><i class="bi bi-moon-fill"></i> {{ refeicao.nome|default:"Jantar" }}</h6>
                            {% if refeicao %}
                                <p class="text-muted small">{{ refeicao.alimentos|truncatewords:5|default:"-" }}</p> 
                            {% else %}
                                 <p class="no-data-message small my-2">Não definido</p>
                            {% endif %}
                        </div>
                    </div>
                    {% endwith %}
                    {# --- FIM DA MUDANÇA --- #}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extrascripts %}
{# Script do gráfico removido #}
{% endblock %}